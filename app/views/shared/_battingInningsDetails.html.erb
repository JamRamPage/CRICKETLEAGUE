<h1><%= if (locals[:team] == 'Home') then @match.hometeam.name else @match.awayteam.name end %> <%= I18n.t('.matches.scorecard.innings_title') %> </h1>
<p style="text-align:center"><%= if locals[:team] == 'Home' && @homeinnings == nil then link_to I18n.t('.matches.create_innings'), new_match_innings_path(@match, @homeinnings) end %></p>
<p style="text-align:center"><%= if locals[:team] == 'Away' && @awayinnings == nil then link_to I18n.t('.matches.create_innings'), new_match_innings_path(@match, @awayinnings) end %></p>
<p style="text-align:center"><%= if (locals[:team] == 'Home' && @homeinnings != nil) then link_to(I18n.t('.matches.edit_innings'), edit_match_innings_path(@match, @homeinnings)) end %></p>
<p style="text-align:center"><%= if (locals[:team] == 'Away' && @awayinnings != nil) then link_to(I18n.t('.matches.edit_innings'), edit_match_innings_path(@match, @awayinnings)) end %></p>

  <table>
    <thead>
      <tr>
        <th></th>
        <th><%= I18n.t('.matches.scorecard.batsman') %></th>
        <th><%= I18n.t('.matches.scorecard.how_out') %></th>
        <th><%= I18n.t('.matches.scorecard.runs') %></th>
        <th><%= I18n.t('.matches.scorecard.balls') %></th>
        <th><%= I18n.t('.matches.scorecard.fours') %></th>
        <th><%= I18n.t('.matches.scorecard.sixes') %></th>
        <th><%= I18n.t('.matches.scorecard.strike_rate') %></th>
        <th><%= link_to I18n.t('.matches.add_innings'), new_batting_innings_path %></th>
        <th colspan="3"></th>
      </tr>
    </thead>

    <tbody>
      <% if (locals[:team] == 'Home') then @homebattinginnings.each do |batting_innings| %>
        <tr>
          <td><%= batting_innings.batsman_number %></td>
          <td><%= batting_innings.Player.name %></td>
          <td><%= batting_innings.outDescription %></td>
          <td><%= batting_innings.runs %></td>
          <td><%= batting_innings.balls %></td>
          <td><%= batting_innings.fours %></td>
          <td><%= batting_innings.sixes %></td>
          <td><%= ((batting_innings.runs.to_f / batting_innings.balls.to_f) * 100).round(2) %></td>
          <td><%= link_to 'Edit', edit_batting_innings_path(batting_innings) %></td>
          <td><%= link_to 'Destroy', batting_innings, method: :delete, data: { confirm: 'Are you sure?' } %></td>
        </tr>
      <% end else @awaybattinginnings.each do |batting_innings| %>
        <tr>
          <td><%= batting_innings.batsman_number %></td>
          <td><%= batting_innings.Player.name %></td>
          <td><%= batting_innings.outDescription %></td>
          <td><%= batting_innings.runs %></td>
          <td><%= batting_innings.balls %></td>
          <td><%= batting_innings.fours %></td>
          <td><%= batting_innings.sixes %></td>
          <td><%= ((batting_innings.runs.to_f / batting_innings.balls.to_f) * 100).round(2) %></td>
          <td><%= link_to 'Edit', edit_batting_innings_path(batting_innings) %></td>
          <td><%= link_to 'Destroy', batting_innings, method: :delete, data: { confirm: 'Are you sure?' } %></td>
        </tr>
      <% end end%>
      <%
      if (locals[:team] == 'Home') then
        @battinginningses = BattingInnings.joins(:Innings => :match).where("innings.match_id" => @match).where("innings.hometeambatted" => true)
        wides = BowlingInnings.joins(:Innings => :match).where("innings.match_id" => @match).where("innings.hometeambatted" => true).sum("wides")
        noballs = BowlingInnings.joins(:Innings => :match).where("innings.match_id" => @match).where("innings.hometeambatted" => true).sum("no_balls")
        miscextras = Innings.joins(:match).where("innings.match_id" => @match).where("innings.hometeambatted" => true).sum("byes + legbyes + penalties")
        overs = BowlingInnings.joins(:Innings => :match).where("innings.match_id" => @match).where("innings.hometeambatted" => true).sum("overs")
      else
        @battinginningses = BattingInnings.joins(:Innings => :match).where("innings.match_id" => @match).where("innings.hometeambatted" => false)
        wides = BowlingInnings.joins(:Innings => :match).where("innings.match_id" => @match).where("innings.hometeambatted" => false).sum("wides")
        noballs = BowlingInnings.joins(:Innings => :match).where("innings.match_id" => @match).where("innings.hometeambatted" => false).sum("no_balls")
        miscextras = Innings.joins(:match).where("innings.match_id" => @match).where("innings.hometeambatted" => false).sum("byes + legbyes + penalties")
        overs = BowlingInnings.joins(:Innings => :match).where("innings.match_id" => @match).where("innings.hometeambatted" => false).sum("overs")
      end
      battedruns = @battinginningses.sum("runs")
      bowledextras = wides + noballs
      wicketsconceded = @battinginningses.where.not(HowOut: 0).where.not(HowOut: 1).count
      %>
      <tr>
        <td>Extras:</td>
        <td></td><td>30(b: <%= if (locals[:team] == 'Home' && !(@homeinnings==nil)) then @homeinnings.byes elsif (locals[:team] == 'Away' && !(@awayinnings==nil)) then @awayinnings.byes end%>,lb: <%= if (locals[:team] == 'Home' && !(@homeinnings==nil)) then @homeinnings.legbyes elsif (locals[:team] == 'Away' && !(@awayinnings==nil)) then @awayinnings.legbyes end %>,w:<%= wides%> ,nb:<%= noballs%> ,p:<%= if (locals[:team] == 'Home' && !(@homeinnings==nil)) then @homeinnings.penalties elsif (locals[:team] == 'Away' && !(@awayinnings==nil)) then @awayinnings.penalties end %>)</td>
      </tr>
      <tr>
        <td><strong>Total:</strong></td>
        <td></td><td><%= battedruns + bowledextras + miscextras%><%= if (wicketsconceded < 10) then '/' end %><%=if (wicketsconceded < 10) then wicketsconceded end %> (<%= overs%> Overs, RR: <%= ((battedruns + bowledextras + miscextras).to_f / overs.to_f).round(2)%>)</td>
      </tr>
    </tbody>

  </table>
